<!-- templates/prompt.html -->
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Perfume Recommender</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='prompt_style.css') }}" />
</head>
<body class="prompt-page">
  <button type="button" id="backButton" class="send-button" aria-label="Back">Back</button>

  <div class="container">
    <h2>Welcome, {{ username }}!</h2>
    <img src="{{ url_for('static', filename='Dahlia.png') }}" alt="Dahlia Flower" class="dahlia-inside" />

    <form method="post" id="prompt-form">
      <textarea
        name="user_input"
        placeholder="EX: Find a subtle perfume..."
        required
      ></textarea>

     <button type="submit" aria-label="Submit" id="sendButton">
  GENERATE
</button>


  <div class="loading-overlay" id="loadingOverlay" style="display: none;">
    <span class="loading-text">SCENTIFY IS BREWING YOUR MATCH...</span>
    <div class="perfume-animation bottle-row">
      <div class="bottle">ðŸŒ¸</div>
      <div class="bottle">ðŸŒ¿</div>
      <div class="bottle">ðŸŒ·</div>
      <div class="bottle">ðŸ’§</div>
      <div class="bottle">âœ¨</div>
    </div>
  </div>

  <script>
    document.getElementById('backButton').onclick = () => {
      window.location.href = "{{ url_for('login') }}";
    };
    const form = document.getElementById('prompt-form');
    const loadingOverlay = document.getElementById('loadingOverlay');
    form.addEventListener('submit', () => {
      form.querySelector("button[type='submit']").disabled = true;
      loadingOverlay.style.display = 'flex';
      document.getElementById('backButton').style.display = 'none';
    });
  </script>
</body>
</html>

<script>
  document.addEventListener("DOMContentLoaded", function () {
    const form = document.getElementById('prompt-form');
    const textarea = form.querySelector("textarea");

    textarea.addEventListener("keydown", function (event) {
      if (event.key === "Enter" && !event.shiftKey) {
        event.preventDefault(); // prevent newline
        form.requestSubmit(); // submit the form programmatically
      }
    });

    const loadingOverlay = document.getElementById('loadingOverlay');
    form.addEventListener('submit', () => {
      form.querySelector("button[type='submit']").disabled = true;
      loadingOverlay.style.display = 'flex';
      document.getElementById('backButton').style.display = 'none';
    });

    document.getElementById('backButton').onclick = () => {
      window.location.href = "{{ url_for('login') }}";
    };
  });
</script>
