<!-- <!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Chatbox</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}" />
</head>
<body class="chat-page">
  <div class="chat-container">
    <h2 class="chat-prompt-label">Describe your ideal scent</h2>

    <form method="POST" class="chat-form">
      <div class="input-wrapper">
        <textarea 
          name="user_input" 
          placeholder="A woody, dark, and spicy perfume perfect for a night-out or nice dinner" 
          rows="2" 
          required
          oninput="this.style.height = 'auto'; this.style.height = this.scrollHeight + 'px';"
        ></textarea>
        <button type="submit" class="send-button" aria-label="Send message">
          <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="none" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-send" viewBox="0 0 24 24">
            <line x1="22" y1="2" x2="11" y2="13"></line>
            <polygon points="22 2 15 22 11 13 2 9 22 2"></polygon>
          </svg>
        </button>
      </div>
    </form>
  </div>
</body>
</html>
<link href="https://fonts.googleapis.com/css2?family=Nunito+Sans:wght@400;600&display=swap" rel="stylesheet">
 -->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <title>Perfume Recommender</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='prompt_style.css') }}" />
    <style>
      /* Fixed position back button top-left */
      #backButton {
        position: fixed;
        top: 20px;
        left: 20px;
        z-index: 10000;
      }
    </style>
</head>
<body class="prompt-page">

    <!-- Back button fixed top-left -->
    <button type="button" id="backButton" class="send-button" aria-label="Back">Back</button>

    <div class="container">
        <h2>Welcome, {{ username }}!</h2>

        {% if user_input %}
            <div class="user-prompt">
                <strong>Your prompt:</strong> {{ user_input }}
            </div>
        {% else %}
            <form method="post" id="prompt-form">
                <textarea
                    name="user_input"
                    placeholder="EX: Find a subtle perfume that is perfect for an evening dinner. It should smell woody and spicy, and evoke a natural feeling. The perfume should be long lasting, and work well in moderate to high temperatures."
                    required
                ></textarea>

                <!-- Arrow submit button -->
                <button type="submit" aria-label="Submit" id="sendButton">
                    <svg
                        width="20"
                        height="20"
                        viewBox="0 0 24 24"
                        fill="none"
                        stroke="white"
                        stroke-width="3"
                        stroke-linecap="round"
                        stroke-linejoin="round"
                    >
                        <line x1="12" y1="19" x2="12" y2="5"></line>
                        <polyline points="5 12 12 5 19 12"></polyline>
                    </svg>
                </button>
            </form>
        {% endif %}

        {% if results %}
            <div class="results">
                <h3>Recommended Perfumes:</h3>
                <ul>
                    {% for result in results %}
                        <li>{{ result }}</li>
                    {% endfor %}
                </ul>
            </div>
        {% endif %}
    </div>

    <!-- Loading overlay -->
    <div class="loading-overlay" id="loadingOverlay" style="display: none;">
        <div class="perfume-animation">
  <svg width="100" height="140" viewBox="0 0 64 90" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img">
    <!-- Rounded bottle base -->
    <ellipse cx="32" cy="65" rx="22" ry="30" fill="#a3c9f1" stroke="#004080" stroke-width="2"/>
    <!-- Bottle neck -->
    <rect x="26" y="15" width="12" height="20" rx="6" ry="6" fill="#2563eb" />
    <!-- Bottle cap -->
    <rect x="27" y="5" width="10" height="12" rx="4" ry="4" fill="#1e40af" />
    <!-- Spray nozzle -->
    <circle cx="32" cy="5" r="4" fill="#1e40af" />
    <!-- Spray mist group -->
    <g id="sprayMist" fill="#a3c9f1" opacity="0.7">
      <circle class="mistParticle" cx="24" cy="0" r="3"/>
      <circle class="mistParticle" cx="32" cy="-4" r="2.5"/>
      <circle class="mistParticle" cx="40" cy="0" r="3"/>
      <circle class="mistParticle" cx="20" cy="-6" r="2"/>
      <circle class="mistParticle" cx="44" cy="-6" r="2"/>
    </g>
  </svg>
</div>
<span>Scentify is brewing your match...</span>
    </div>

    <script>
        // Back button always goes back to login page from prompt page
        const backButton = document.getElementById('backButton');
        backButton.addEventListener('click', () => {
            window.location.href = "{{ url_for('login') }}";
        });

        // Show loading overlay and hide back button on form submit
        const form = document.getElementById('prompt-form');
        const loadingOverlay = document.getElementById('loadingOverlay');

        if (form) {
            form.addEventListener('submit', () => {
                form.querySelector("button[type='submit']").disabled = true;
                loadingOverlay.style.display = 'flex';
                backButton.style.display = 'none'; // hide back button while loading
            });
        }
    </script>
    <script id="perfume-notes-data" type="application/json">
        {{ all_notes | tojson | safe }}
    </script>
    <div class="scent-pyramid">
        <div class="note-box top-notes">
            <h4>Top Notes</h4>
            <ul id="top-notes-list"></ul>
        </div>
        <div class="note-box middle-notes">
            <h4>Middle Notes</h4>
            <ul id="middle-notes-list"></ul>
        </div>
        <div class="note-box base-notes">
            <h4>Base Notes</h4>
            <ul id="base-notes-list"></ul>
        </div>
    </div>

    <script>
        const perfumeNotes = JSON.parse(
            document.getElementById('perfume-notes-data').textContent
            );
        function updateNoteList(listId, notes) {
            const ul = document.getElementById(listId);
            ul.innerHTML = '';
            if (!notes) return;
            notes.forEach(note => {
            const li = document.createElement('li');
            li.textContent = note;
            ul.appendChild(li);
            });
        }

        function showNotes(perfumeName) {
            const notes = perfumeNotes[perfumeName];
            if (!notes) return;

            updateNoteList('top-notes-list', notes[0]);
            updateNoteList('middle-notes-list', notes[1]);
            updateNoteList('base-notes-list', notes[2]);
        }
    </script>


    {% if perfumes %}
    <div class="perfume-buttons">
        <h4>View Notes For:</h4>
        {% for perfume in perfumes %}
        <button 
            class="perfume-button" 
            onclick="showNotes('{{ perfume }}')"
        >
            {{ perfume }}
        </button>
        {% endfor %}
    </div>
    {% endif %}

</body>
</html>

