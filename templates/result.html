<!-- templates/result.html -->
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Recommendations</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='prompt_style.css') }}" />
</head>
<body class="prompt-page">
  <button type="button" id="backButton" class="send-button" aria-label="Back">Back</button>

  <div class="container">
    <h2>Welcome, {{ username }}!</h2>
    <div class="user-prompt">
      <strong>Your prompt:</strong> {{ user_input }}
    </div>

    {% if results %}
    <div class="results">
      <h3>Recommended Perfumes:</h3>
      <ul>
        {% for result in results %}
          <li>{{ result }}</li>
        {% endfor %}
      </ul>
    </div>
    {% endif %}

    <script>
        const perfumeNotes = JSON.parse(document.getElementById('perfume-notes-data').textContent);

        function updateNoteList(listId, notes) {
            const ul = document.getElementById(listId);
            ul.innerHTML = '';
            if (!notes) return;
            notes.forEach(note => {
                const li = document.createElement('li');
                li.textContent = note;
                ul.appendChild(li);
            });
        }

        function showNotes(perfumeName) {
            const notes = perfumeNotes[perfumeName];
            if (!notes) return;
            updateNoteList('top-notes-list', notes[0]);
            updateNoteList('middle-notes-list', notes[1]);
            updateNoteList('base-notes-list', notes[2]);
        }

        document.getElementById('backButton').onclick = () => {
            window.location.href = "{{ url_for('chat') }}";
        };

        // Assign selectedPerfume from Flask variable (JS string literal)
        // const selectedPerfume = {{ selected_perfume | default('""') | tojson }};


        // Immediately call showNotes if selectedPerfume is set
        if (selectedperfume) {
            showNotes(selectedperfume);
        }

    </script>

    {% if perfumes %}
    <div class="perfume-buttons">
      <h4>View Notes For:</h4>
      {% for perfume in perfumes %}
      <button class="perfume-button" onclick="showNotes('{{ perfume }}')">{{ perfume }}</button>
      {% endfor %}
    </div>
    {% endif %}

    <div class="scent-pyramid">
      <div class="note-box top-notes">
        <h4>Top Notes</h4>
        <ul id="top-notes-list"></ul>
      </div>
      <div class="note-box middle-notes">
        <h4>Middle Notes</h4>
        <ul id="middle-notes-list"></ul>
      </div>
      <div class="note-box base-notes">
        <h4>Base Notes</h4>
        <ul id="base-notes-list"></ul>
      </div>
    </div>

    <script id="perfume-notes-data" type="application/json">
      {{ all_notes | tojson | safe }}
    </script>

    <!-- <script> -->
    <!-- //   const perfumeNotes = JSON.parse(document.getElementById('perfume-notes-data').textContent);

    //   function updateNoteList(listId, notes) {
    //     const ul = document.getElementById(listId);
    //     ul.innerHTML = '';
    //     if (!notes) return;
    //     notes.forEach(note => {
    //       const li = document.createElement('li');
    //       li.textContent = note;
    //       ul.appendChild(li);
    //     });
    //   }

    //   function showNotes(perfumeName) {
    //     const notes = perfumeNotes[perfumeName];
    //     if (!notes) return;
    //     updateNoteList('top-notes-list', notes[0]);
    //     updateNoteList('middle-notes-list', notes[1]);
    //     updateNoteList('base-notes-list', notes[2]);
    //   }

    //   // Back to prompt page
    //   document.getElementById('backButton').onclick = () => {
    //     window.location.href = "{{ url_for('chat') }}";
    //   };

      // Automatically show notes for the first perfume
        const perfumeNotes = JSON.parse(document.getElementById('perfume-notes-data').textContent);

        function updateNoteList(listId, notes) {
            const ul = document.getElementById(listId);
            ul.innerHTML = '';
            if (!notes) return;
            notes.forEach(note => {
            const li = document.createElement('li');
            li.textContent = note;
            ul.appendChild(li);
            });
        }

        function showNotes(perfumeName) {
            const notes = perfumeNotes[perfumeName];
            if (!notes) return;
            updateNoteList('top-notes-list', notes[0]);
            updateNoteList('middle-notes-list', notes[1]);
            updateNoteList('base-notes-list', notes[2]);
        }

        document.getElementById('backButton').onclick = () => {
            window.location.href = "{{ url_for('chat') }}";
        };

        // âœ… Safer way: assign selected_perfume as a JS string
        document.addEventListener("DOMContentLoaded", function () {
            // const selectedPerfume = JSON.parse('{{ selected_perfume | default('""', true) | tojson | safe }}');
            if (selectedPerfume) {
            showNotes(selectedPerfume);
            }
        }); -->
    <!-- </script> -->
  </div>
</body>
</html>
