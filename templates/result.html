<!-- templates/result.html -->
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Recommendations</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='results.css') }}" />
</head>
<body class="prompt-page">
  <button type="button" id="backButton" class="send-button" aria-label="Back">Back</button>

  <script id="perfume-notes-data" type="application/json">
    {{ all_notes | tojson | safe }}
  </script>

  <script id="perfume-descriptions-data" type="application/json">
    {{ descriptions | tojson | safe }}
  </script>

  <div class="container">
    <div class="description-layout">
      <div class="description-column image-col">
        <img id="perfume-description-image" src="{{ url_for('static', filename='images/default.png') }}"
          alt="Perfume image" />
      </div>

      <div class="description-column text-col">
        <h4>Description</h4>
        <p id="perfume-description-text">Click a perfume to view its description.</p>
      </div>

      <div class="description-column notes-col">
        <div class="note-box top-notes">
          <h4>Top Notes</h4>
          <ul id="top-notes-list"></ul>
        </div>
        <div class="note-box middle-notes">
          <h4>Middle Notes</h4>
          <ul id="middle-notes-list"></ul>
        </div>
        <div class="note-box base-notes">
          <h4>Base Notes</h4>
          <ul id="base-notes-list"></ul>
        </div>
      </div>
    </div>




    {% if perfumes %}
    <div class="perfume-buttons">
      <h4>View Notes For:</h4>
      <div class="perfume-card-grid">
        {% for perfume in perfumes %}
        <div class="perfume-card" onclick="showNotes('{{ perfume }}')">
          <div class="perfume-image">
            <img src="{{ descriptions[perfume][1] }}" alt="{{ perfume }}">
          </div>
          <div class="perfume-info">
            <h4 class="perfume-name">{{ perfume }}</h4>
            <div class="top-notes-preview">
              {% for note in all_notes[perfume][0][:3] %}
              <span class="note-chip">{{ note }}</span>
              {% endfor %}
              {% if all_notes[perfume][0]|length > 3 %}
              <span class="note-chip">+{{ all_notes[perfume][0]|length - 3 }}</span>
              {% endif %}
            </div>
          </div>
        </div>
        {% endfor %}
      </div>
    </div>
    {% endif %}

  <script>
    const perfumeNotes = JSON.parse(document.getElementById('perfume-notes-data').textContent);
    const perfumeDescriptions = JSON.parse(document.getElementById('perfume-descriptions-data').textContent);
    const descriptionText = document.getElementById('perfume-description-text');


    function updateNoteList(listId, notes) {
      const ul = document.getElementById(listId);
      ul.innerHTML = '';
      if (!notes) return;
      notes.forEach(note => {
        const li = document.createElement('li');
        li.textContent = note;
        ul.appendChild(li);
      });
    }

    function showNotes(perfumeName) {
      const notes = perfumeNotes[perfumeName];
      if (!notes) return;
      updateNoteList('top-notes-list', notes[0].slice(0,6));
      updateNoteList('middle-notes-list', notes[1].slice(0,6));
      updateNoteList('base-notes-list', notes[2].slice(0,6));

      // const description = perfumeDescriptions[perfumeName] || "No description available.";
      // descriptionText.textContent = description;
      const descriptionData = perfumeDescriptions[perfumeName];
      if (descriptionData) {
        const [desc, imgPath] = descriptionData;
        descriptionText.textContent = desc;
        document.getElementById('perfume-description-image').src = imgPath;
      } else {
        descriptionText.textContent = "No description available.";
        document.getElementById('perfume-description-image').src = "{{ url_for('static', filename='images/default.png') }}";
      }
    }

    document.getElementById('backButton').onclick = () => {
      window.location.href = "{{ url_for('chat') }}";
    };

    const selectedPerfume = {{ selected_perfume | default('""') | tojson }};
    if (selectedPerfume) {
      showNotes(selectedPerfume);
    }
  </script>
</body>
</html>
